<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å MyZaim</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 700px;
        margin: 25px auto;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    h1 {
        margin-top: 0;
        text-align: center;
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 20px;
    }
    input, textarea {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }
    textarea {
        min-height: 60px;
    }

    button {
        width: 100%;
        padding: 14px;
        background: #2563eb;
        border: none;
        color: #fff;
        border-radius: 6px;
        margin-top: 30px;
        font-size: 18px;
        transition: 0.2s;
    }
    button:hover {
        background: #1e40af;
    }

    .benefit-item {
        background: #eee;
        padding: 10px;
        border-radius: 6px;
        margin-top: 10px;
    }
</style>
</head>

<body>
<div class="container">
    <h1>‚öô –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å MyZaim</h1>

    <label>GitHub Token</label>
    <input id="token" type="text" placeholder="ghp_xxxxxxxxxxxxxxxxxxx">

    <label>GitHub Owner</label>
    <input id="owner" type="text" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">

    <label>GitHub Repo</label>
    <input id="repo" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è">

    <button onclick="loadConfig()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>

    <div id="editor" style="display:none;">

        <label>Primary Color</label>
        <input id="primaryColor">

        <label>Secondary Color</label>
        <input id="secondaryColor">

        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
        <input id="heroTitle">

        <label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
        <textarea id="heroSubtitle"></textarea>

        <label>–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
        <input id="heroButtonText">

        <label>–¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏</label>
        <input id="heroButtonColor">

        <label>URL –±–∞–Ω–Ω–µ—Ä–∞</label>
        <input id="bannerUrl">

        <h2>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h2>
        <div id="benefits"></div>

        <button onclick="saveConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>
    </div>
</div>

<script>
async function loadConfig() {
    const token = document.getElementById("token").value.trim();
    const owner = document.getElementById("owner").value.trim();
    const repo  = document.getElementById("repo").value.trim();

    const url = `https://api.github.com/repos/${owner}/${repo}/contents/config.json`;

    const response = await fetch(url, {
        headers: { "Authorization": `Bearer ${token}` }
    });

    if (!response.ok) {
        alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: –ø—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω/—Ä–µ–ø–æ");
        return;
    }

    const file = await response.json();
    window.sha = file.sha;

    const config = JSON.parse(atob(file.content));
    window.currentConfig = config;

    document.getElementById("primaryColor").value = config.primaryColor;
    document.getElementById("secondaryColor").value = config.secondaryColor;
    document.getElementById("heroTitle").value = config.heroTitle;
    document.getElementById("heroSubtitle").value = config.heroSubtitle;
    document.getElementById("heroButtonText").value = config.heroButtonText;
    document.getElementById("heroButtonColor").value = config.heroButtonColor;
    document.getElementById("bannerUrl").value = config.bannerUrl;

    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ –¥–ª—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
    const benefitsBlock = document.getElementById("benefits");
    benefitsBlock.innerHTML = "";
    config.benefits.forEach((b, i) => {
        const div = document.createElement("div");
        div.className = "benefit-item";

        const labelTitle = document.createElement("label");
        labelTitle.textContent = "–ù–∞–∑–≤–∞–Ω–∏–µ";
        div.appendChild(labelTitle);

        const inputTitle = document.createElement("input");
        inputTitle.id = `benefit_title_${i}`;
        inputTitle.value = b.title;
        div.appendChild(inputTitle);

        const labelText = document.createElement("label");
        labelText.textContent = "–û–ø–∏—Å–∞–Ω–∏–µ";
        div.appendChild(labelText);

        const textareaText = document.createElement("textarea");
        textareaText.id = `benefit_text_${i}`;
        textareaText.textContent = b.text;
        div.appendChild(textareaText);

        benefitsBlock.appendChild(div);
    });

    document.getElementById("editor").style.display = "block";
}

async function saveConfig() {
    const token = document.getElementById("token").value.trim();
    const owner = document.getElementById("owner").value.trim();
    const repo  = document.getElementById("repo").value.trim();

    let updated = { ...window.currentConfig };

    updated.primaryColor = document.getElementById("primaryColor").value;
    updated.secondaryColor = document.getElementById("secondaryColor").value;
    updated.heroTitle = document.getElementById("heroTitle").value;
    updated.heroSubtitle = document.getElementById("heroSubtitle").value;
    updated.heroButtonText = document.getElementById("heroButtonText").value;
    updated.heroButtonColor = document.getElementById("heroButtonColor").value;
    updated.bannerUrl = document.getElementById("bannerUrl").value;

    updated.benefits = updated.benefits.map((b, i) => ({
        title: document.getElementById(`benefit_title_${i}`).value,
        text: document.getElementById(`benefit_text_${i}`).value
    }));

    const url = `https://api.github.com/repos/${owner}/${repo}/contents/config.json`;

    const content = btoa(JSON.stringify(updated, null, 2));

    const response = await fetch(url, {
        method: "PUT",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: "Update config.json",
            content: content,
            sha: window.sha
        })
    });

    if (response.ok) {
        alert("–ö–æ–Ω—Ñ–∏–≥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!");
    } else {
        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");
    }
}
</script>

</body>
</html>
