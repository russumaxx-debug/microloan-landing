<script>
let currency = "MDL"; // дефолт

async function loadConfig() {
    try {
        const response = await fetch('config.json');
        if (!response.ok) throw new Error('Config не найден');
        return await response.json();
    } catch(e) {
        console.error(e);
        return { 
            primaryColor:'#667eea',
            secondaryColor:'#764ba2',
            heroTitle:'Быстрые займы онлайн',
            heroSubtitle:'Получите до 100,000',
            heroButtonText:'Получить займ',
            heroButtonColor:'#ff6b6b',
            bannerUrl:'',
            currency:"MDL",
            benefits:[]
        };
    }
}

function applyConfig(config){
    currency = config.currency || "MDL";

    const root=document.documentElement;
    root.style.setProperty('--primary-color',config.primaryColor);
    root.style.setProperty('--secondary-color',config.secondaryColor);

    document.getElementById('heroTitle').textContent=config.heroTitle;
    document.getElementById('heroSubtitle').textContent=config.heroSubtitle;

    const heroBtn=document.getElementById('heroBtn');
    heroBtn.textContent=config.heroButtonText;
    heroBtn.style.background=config.heroButtonColor;
    heroBtn.style.color='#fff';

    document.getElementById('heroBanner').src=config.bannerUrl;

    const grid=document.getElementById('benefitsGrid');
    grid.innerHTML=config.benefits.map(b=>`
        <div class="benefit-card">
            <div class="benefit-icon">✨</div>
            <div class="benefit-title">${b.title}</div>
            <div class="benefit-text">${b.text}</div>
        </div>
    `).join('');
}

const amountSlider=document.getElementById('amountSlider');
const daysSlider=document.getElementById('daysSlider');

function updateCalculator(){
    const amount=parseInt(amountSlider.value);
    const days=parseInt(daysSlider.value);

    const commission=amount*0.005*days;
    const total=amount+commission;

    document.getElementById('amountValue').textContent =
        amount.toLocaleString('ru-RU') + " " + currency;

    document.getElementById('daysValue').textContent =
        days + " дн.";

    document.getElementById('resultAmount').textContent =
        Math.round(total).toLocaleString('ru-RU') + " " + currency;
}

amountSlider.addEventListener('input',updateCalculator);
daysSlider.addEventListener('input',updateCalculator);

function handleFormSubmit(e){
    e.preventDefault();
    const formData={
        lastName:e.target.lastName.value,
        firstName:e.target.firstName.value,
        phone:e.target.phone.value
    };
    console.log('Заявка:',formData);
    document.getElementById('formMessage').classList.add('success');
    e.target.reset();
    setTimeout(()=>{document.getElementById('formMessage').classList.remove('success')},3000);
}

function goToAdmin(){ alert('Админ-панель пока не готова'); }
function scrollToForm(){ 
    document.querySelector('.form-section').scrollIntoView({behavior:'smooth'});
}

(async()=>{
    const config=await loadConfig();
    applyConfig(config);
    updateCalculator();
})();
</script>
